  # - name: Generally useful debug info
  - debug: msg="we got the debug "
  - debug: msg="USER={{lookup('env','USER')}}"
  - debug: msg="GROUPS={{groups}}"

  - name: install docker dependecies
    yum:
      name: "{{ docker_packages }}"
      state: latest
      # validate_certs: no
      update_cache: yes
      disablerepo: "epel"
    when: ansible_os_family == 'RedHat' and ansible_distribution_major_version == '7'

  - name: Import Docker CE repository gpg key
    rpm_key:
      key: https://download.docker.com/linux/centos/gpg
      state: present
      validate_certs: no

  - name: Add Docker CE repository
    get_url:
      url: https://download.docker.com/linux/centos/docker-ce.repo
      dest: /etc/yum.repos.d/docker-ce.repo
      force: yes
      owner: root
      group: root
      mode: 0644
      validate_certs: no

  - name: Enable Docker Edge repo
    ini_file:
      dest: /etc/yum.repos.d/docker-ce.repo
      section: 'docker-ce-edge'
      option: enabled
      value: 0
    become: yes
    when: enable_docker_edge

  - name: Enable Docker Test repo
    ini_file:
      dest: /etc/yum.repos.d/docker-ce.repo
      section: 'docker-ce-test'
      option: enabled
      value: 0
    become: yes
    when: enable_docker_test

  - name: Install Docker CE
    yum:
      name: docker-ce
      state: latest
      update_cache: yes
      validate_certs: no

  - name: Start Docker service
    service:
      name: docker
      state: started
      enabled: yes
    become: yes

  - name: Add user vagrant to docker group
    user:
      name: vagrant
      groups: docker
      append: yes
    become: yes
